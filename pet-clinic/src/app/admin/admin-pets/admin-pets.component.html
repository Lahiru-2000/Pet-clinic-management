<div class="admin-pets-container">

  <div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h1 class="page-title">
          <i class="bi bi-heart-fill me-2"></i>
          Pet Management
        </h1>
        <p class="page-subtitle">Manage all pets in the system</p>
      </div>
     
    </div>
  </div>


  <div class="filters-section">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">
          <i class="bi bi-funnel me-2"></i>
          Filters & Search
        </h5>
      </div>
      <div class="card-body">
        <div class="row g-3">
      
          <div class="col-md-3">
            <label class="form-label">Search</label>
            <input 
              type="text" 
              class="form-control" 
              placeholder="Pet name, breed, owner..." 
              [(ngModel)]="searchTerm"
              (input)="applyFilters()"
            >
          </div>

 
          <div class="col-md-2">
            <label class="form-label">Type</label>
            <select class="form-select" [(ngModel)]="selectedType" (change)="applyFilters()">
              <option value="">All Types</option>
              <option *ngFor="let type of petTypes" [value]="type">{{ type }}</option>
            </select>
          </div>

          <div class="col-md-2">
            <label class="form-label">Status</label>
            <select class="form-select" [(ngModel)]="selectedStatus" (change)="applyFilters()">
              <option [ngValue]="null">All Status</option>
              <option *ngFor="let status of statusOptions" [ngValue]="status.value">
                {{ status.label }}
              </option>
            </select>
          </div>

          <div class="col-md-2">
            <label class="form-label">Min Age</label>
            <input 
              type="number" 
              class="form-control" 
              placeholder="Min" 
              [(ngModel)]="ageMin"
              (input)="applyFilters()"
              min="0"
            >
          </div>

          <div class="col-md-2">
            <label class="form-label">Max Age</label>
            <input 
              type="number" 
              class="form-control" 
              placeholder="Max" 
              [(ngModel)]="ageMax"
              (input)="applyFilters()"
              min="0"
            >
          </div>

          <div class="col-md-1 d-flex align-items-end">
            <button class="btn btn-outline-secondary" (click)="clearFilters()">
              <i class="bi bi-x-circle"></i>
            </button>
          </div>
        </div>

        <div class="row g-3 mt-2">
          <div class="col-md-3">
            <label class="form-label">Registration From</label>
            <input 
              type="date" 
              class="form-control" 
              [(ngModel)]="registrationDateFrom"
              (change)="applyFilters()"
            >
          </div>
          <div class="col-md-3">
            <label class="form-label">Registration To</label>
            <input 
              type="date" 
              class="form-control" 
              [(ngModel)]="registrationDateTo"
              (change)="applyFilters()"
            >
          </div>
          <div class="col-md-6 d-flex align-items-end">
            <div class="text-muted">
              <i class="bi bi-info-circle me-1"></i>
              Showing {{ filteredPets.length }} of {{ pets.length }} pets
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <div *ngIf="isLoading" class="loading-section">
    <div class="text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Loading pets...</p>
    </div>
  </div>

 
  <div *ngIf="!isLoading">
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Type</th>
            <th>Breed</th>
            <th>Age</th>
            <th>Owner</th>
            <th>Registered</th>
            <th>Status</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let pet of paginatedPets; index as i">
            <td>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
            <td>{{ pet.name }}</td>
            <td>{{ pet.type }}</td>
            <td>{{ pet.breed }}</td>
            <td>{{ getAgeText(pet.age) }}</td>
            <td>{{ pet.ownerName || pet.owner }}</td>
            <td>{{ formatDate(pet.registrationDate) }}</td>
            <td>
              <span [class]="getStatusBadgeClass(pet)">{{ getStatusText(pet) }}</span>
            </td>
            <td class="text-end">
              <div class="btn-group">
                <button class="btn btn-outline-primary btn-sm" (click)="openDetailsModal(pet)" title="View Details">
                  <i class="bi bi-eye"></i>
                </button>
                <button class="btn btn-outline-warning btn-sm" (click)="openEditModal(pet)" title="Edit Pet">
                  <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-outline-danger btn-sm" (click)="openDeleteModal(pet)" title="Delete Pet">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="filteredPets.length === 0" class="empty-state">
      <div class="text-center">
        <i class="bi bi-heart display-1 text-muted"></i>
        <h3 class="mt-3">No pets found</h3>
        <p class="text-muted">No pets match your current filters. Try adjusting your search criteria.</p>
        <button class="btn btn-primary" (click)="clearFilters()">Clear Filters</button>
      </div>
    </div>
  </div>

  <div *ngIf="totalPages > 1" class="pagination-section">
    <nav aria-label="Pets pagination">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link" (click)="changePage(currentPage - 1)">
            <i class="bi bi-chevron-left"></i>
          </button>
        </li>
        
        <li 
          *ngFor="let page of [].constructor(totalPages); let i = index" 
          class="page-item" 
          [class.active]="currentPage === i + 1"
        >
          <button class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</button>
        </li>
        
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button class="page-link" (click)="changePage(currentPage + 1)">
            <i class="bi bi-chevron-right"></i>
          </button>
        </li>
      </ul>
    </nav>
  </div>

<!-- Details Modal -->
<div class="modal fade" id="petDetailsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-heart me-2"></i>
          {{ currentPet?.name }} Details
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" *ngIf="currentPet">
        <div class="row g-3">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">Pet Information</div>
              <div class="card-body">
                <div class="mb-2"><strong>Name:</strong> {{ currentPet.name }}</div>
                <div class="mb-2"><strong>Type:</strong> {{ currentPet.type }}</div>
                <div class="mb-2"><strong>Breed:</strong> {{ currentPet.breed }}</div>
                <div class="mb-2"><strong>Age:</strong> {{ getAgeText(currentPet.age) }}</div>
                <div><strong>Status:</strong> <span [class]="getStatusBadgeClass(currentPet)">{{ getStatusText(currentPet) }}</span></div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">Owner Information</div>
              <div class="card-body">
                <div class="mb-2"><strong>Email:</strong> {{ currentPet.owner }}</div>
                <div class="mb-2" *ngIf="currentPet.ownerName"><strong>Name:</strong> {{ currentPet.ownerName }}</div>
                <div class="mb-2" *ngIf="currentPet.ownerPhone"><strong>Phone:</strong> {{ currentPet.ownerPhone }}</div>
                <div><strong>Registered:</strong> {{ formatDate(currentPet.registrationDate) }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
</div>

<div class="modal fade" id="createPetModal" tabindex="-1" aria-labelledby="createPetModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="createPetModalLabel">
          <i class="bi bi-plus-circle me-2"></i>
          Add New Pet
        </h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeCreateModal()"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="createPet()">
  
          <div class="section-header">
            <h6><i class="bi bi-heart me-2"></i>Pet Information</h6>
          </div>
          
          <div class="row g-3 mb-4">
            <div class="col-md-6">
              <label class="form-label">Pet Name *</label>
              <input 
                type="text" 
                class="form-control" 
                [(ngModel)]="petForm.name" 
                name="name" 
                required
              >
            </div>
            <div class="col-md-6">
              <label class="form-label">Type *</label>
              <select class="form-select" [(ngModel)]="petForm.type" name="type" required>
                <option value="">Select Type</option>
                <option *ngFor="let type of petTypes" [value]="type">{{ type }}</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Breed *</label>
              <input 
                type="text" 
                class="form-control" 
                [(ngModel)]="petForm.breed" 
                name="breed" 
                required
              >
            </div>
            <div class="col-md-6">
              <label class="form-label">Age (years) *</label>
              <input 
                type="number" 
                class="form-control" 
                [(ngModel)]="petForm.age" 
                name="age" 
                min="0" 
                step="0.1"
                required
              >
            </div>
            <div class="col-md-6">
              <label class="form-label">Gender</label>
              <select class="form-select" [(ngModel)]="petForm.gender" name="gender">
                <option value="male">Male</option>
                <option value="female">Female</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Weight (kg)</label>
              <input 
                type="number" 
                class="form-control" 
                [(ngModel)]="petForm.weight" 
                name="weight" 
                min="0" 
                step="0.1"
              >
            </div>
      
          </div>

   
          <div class="section-header">
            <h6><i class="bi bi-person me-2"></i>Owner Information</h6>
          </div>
          
          <div class="row g-3 mb-4">
            <div class="col-12">
              <label class="form-label">Search Owner</label>
              <div class="position-relative">
                <input 
                  type="text" 
                  class="form-control" 
                  [(ngModel)]="ownerSearchTerm"
                  (input)="searchOwners()"
                  placeholder="Type owner name or email..."
                  name="ownerSearch"
                >
                <div *ngIf="isSearchingOwners" class="search-spinner">
                  <div class="spinner-border spinner-border-sm" role="status"></div>
                </div>
              </div>
              
              <div *ngIf="owners.length > 0" class="owner-results">
                <div 
                  *ngFor="let owner of owners" 
                  class="owner-result-item"
                  (click)="selectOwner(owner)"
                >
                  <div class="owner-info">
                    <strong>{{ owner.name }}</strong>
                    <small class="text-muted d-block">{{ owner.email }}</small>
                    <small class="text-muted" *ngIf="owner.phone">{{ owner.phone }}</small>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="col-md-6">
              <label class="form-label">Owner Email *</label>
              <input 
                type="email" 
                class="form-control" 
                [(ngModel)]="petForm.owner" 
                name="owner" 
                required
              >
            </div>
            <div class="col-md-6">
              <label class="form-label">Owner Name</label>
              <input 
                type="text" 
                class="form-control" 
                [(ngModel)]="petForm.ownerName" 
                name="ownerName"
              >
            </div>
            <div class="col-md-6">
              <label class="form-label">Owner Phone</label>
              <input 
                type="tel" 
                class="form-control" 
                [(ngModel)]="petForm.ownerPhone" 
                name="ownerPhone"
              >
            </div>
          
          </div>

     
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label">Notes</label>
              <textarea 
                class="form-control" 
                [(ngModel)]="petForm.notes" 
                name="notes" 
                rows="3"
                placeholder="Any additional notes about the pet..."
              ></textarea>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeCreateModal()">Cancel</button>
        <button 
          type="button" 
          class="btn btn-primary" 
          (click)="createPet()"
          [disabled]="isCreating || !isValidPetForm()"
        >
          <span *ngIf="isCreating" class="spinner-border spinner-border-sm me-2" role="status"></span>
          {{ isCreating ? 'Creating...' : 'Create Pet' }}
        </button>
      </div>
    </div>
  </div>
</div>



<div *ngIf="showDeleteModal && currentPet" class="custom-modal-backdrop">
  <div class="custom-modal">
    <div class="custom-modal-header">
      <h5><i class="bi bi-trash"></i> Delete Pet</h5>
    </div>
    <div class="custom-modal-body">
      <div class="alert alert-danger" role="alert">
        <i class="bi bi-exclamation-triangle"></i>
        <strong>Warning!</strong> This action cannot be undone.
      </div>
      <p>Are you sure you want to delete this pet?</p>
      <div class="pet-info-card mb-3">
        <h6>{{ currentPet.name }}</h6>
        <p class="mb-1"><strong>Type:</strong> {{ currentPet.type }}</p>
        <p class="mb-1"><strong>Breed:</strong> {{ currentPet.breed }}</p>
        <p class="mb-1"><strong>Age:</strong> {{ getAgeText(currentPet.age) }}</p>
        <p class="mb-0"><strong>Owner:</strong> {{ currentPet.ownerName || currentPet.owner }}</p>
      </div>
    </div>
    <div class="custom-modal-footer d-flex gap-2 justify-content-end">
      <button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">Cancel</button>
      <button type="button" class="btn btn-danger" (click)="deletePet()">
        <span *ngIf="isDeleting" class="spinner-border spinner-border-sm me-2"></span>
        Delete Pet
      </button>
    </div>
  </div>
</div>

 